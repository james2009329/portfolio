<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>James Lin - Projects Portfolio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Fixed STLLoader import -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/loaders/STLLoader.js"></script>
    <style>
        /* Your existing CSS remains the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            scroll-behavior: smooth;
        }

        /* ... (all your existing CSS styles remain exactly the same) ... */

    </style>
</head>
<body>
    <!-- Your existing HTML structure remains the same -->
    <nav>
        <a href="#home"><i class="fas fa-home"></i> Home</a>
        <a href="#about"><i class="fas fa-user"></i> About</a>
        <a href="#past-projects"><i class="fas fa-archive"></i> Past</a>
        <a href="#current-projects"><i class="fas fa-cogs"></i> Current</a>
        <a href="#contact"><i class="fas fa-envelope"></i> Contact</a>
    </nav>

    <section id="home" class="hero">
        <div class="hero-content">
            <h1>James Lin</h1>
            <p>Design & Engineering Portfolio</p>
            <a href="#past-projects" class="hero-cta">View My Work</a>
        </div>
    </section>

    <main>
        <!-- Your existing sections remain the same -->
        <section id="about">
            <h2>About Me</h2>
            <div class="about-content">
                <p><strong>[Add your introduction here]</strong></p>
                <p>Write about your background, education, interests, and what drives your passion for engineering and design. Share your story and what makes you unique.</p>
                <p>[You can add more paragraphs about your skills, experience, or goals]</p>
            </div>
        </section>

        <section id="past-projects">
            <h2>Past Projects</h2>
            <div class="project-grid">
                <!-- Your project cards remain the same -->
                <!-- Dragster card with 3D button -->
                <div class="project-card">
                    <div class="project-image">
                        <div class="image-placeholder">Add Project Image</div>
                    </div>
                    <div class="project-content">
                        <h3>Dragster</h3>
                        <p><strong>Materials:</strong> Steel axles, graphite lubricant, glass fiber impregnated PETG body and wheels</p>
                        <p>Maximized aerodynamic efficiency by minimizing drag. Front wheels recessed, rear tapered, fully enclosed wheels. Internal ribs and hole modifications increased stiffness and minimized friction.</p>
                        <p><strong>[Add performance results and competition outcomes]</strong></p>
                        <button class="view-3d-btn" onclick="open3DViewer('dragster')">
                            <i class="fas fa-cube"></i> View 3D Model
                        </button>
                    </div>
                </div>
                <!-- Other project cards... -->
            </div>
        </section>

        <section id="current-projects">
            <h2>Current Projects</h2>
            <div class="project-grid">
                <!-- Robot Dog -->
                <div class="project-card">
                    <div class="project-image">
                        <div class="image-placeholder">Add Project Image</div>
                    </div>
                    <div class="project-content">
                        <h3>Robot Dog</h3>
                        <p>Developing a quadrupedal robot integrating mechanical design, electrical systems, and programming for autonomous movement.</p>
                        <p><strong>[Add current progress, technologies used, and goals]</strong></p>
                        <ul>
                            <li>[Feature or component 1]</li>
                            <li>[Feature or component 2]</li>
                            <li>[Feature or component 3]</li>
                        </ul>
                        <button class="view-3d-btn" onclick="open3DViewer('robotdog')">
                            <i class="fas fa-cube"></i> View 3D Model
                        </button>
                    </div>
                </div>

                <!-- Custom 3D Printer -->
                <div class="project-card">
                    <div class="project-image">
                        <div class="image-placeholder">Add Project Image</div>
                    </div>
                    <div class="project-content">
                        <h3>Custom 3D Printer</h3>
                        <p>Building and modifying a 3D printer from scratch with upgraded mechanical components, firmware tuning, and custom features.</p>
                        <p><strong>[Add specifications, modifications, and improvements]</strong></p>
                        <ul>
                            <li>[Upgrade or modification 1]</li>
                            <li>[Upgrade or modification 2]</li>
                            <li>[Upgrade or modification 3]</li>
                        </ul>
                        <button class="view-3d-btn" onclick="open3DViewer('printer')">
                            <i class="fas fa-cube"></i> View 3D Model
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section id="contact">
            <h2>Contact Me</h2>
            <div class="contact-container">
                <div class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <a href="mailto:your.email@example.com">your.email@example.com</a>
                </div>
                <div class="contact-item">
                    <i class="fab fa-linkedin"></i>
                    <a href="https://www.linkedin.com/in/yourprofile" target="_blank">linkedin.com/in/yourprofile</a>
                </div>
                <div class="contact-item">
                    <i class="fab fa-github"></i>
                    <a href="https://github.com/yourprofile" target="_blank">github.com/yourprofile</a>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 James Lin. All rights reserved.</p>
    </footer>

    <!-- 3D Viewer Modal -->
    <div id="viewer-modal" class="viewer-modal">
        <div class="viewer-container">
            <button class="close-viewer" onclick="close3DViewer()">
                <i class="fas fa-times"></i> Close
            </button>
            <div class="loading-text" id="loading-text">
                <div class="spinner"></div>
                <div>Loading 3D model...</div>
                <div style="font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.8;" id="loading-details">Initializing viewer...</div>
            </div>
            <canvas id="viewer-canvas" class="viewer-canvas"></canvas>
            <div class="viewer-instructions">
                <i class="fas fa-mouse"></i> Left click & drag to rotate | Scroll to zoom
            </div>
        </div>
    </div>

    <script>
        let scene, camera, renderer, currentModel, animationId;
        let controls = {
            isDragging: false,
            previousMousePosition: { x: 0, y: 0 }
        };

        // Model URLs - Using direct GitHub raw URLs
        const modelUrls = {
            'dragster': 'https://raw.githubusercontent.com/james2009329/portfolio/main/Wind%20tunnel%20Dragster.stl',
            'robotdog': 'https://raw.githubusercontent.com/james2009329/portfolio/main/Robo%20Dog.stl',
            'printer': 'https://raw.githubusercontent.com/james2009329/portfolio/main/3D-Printer.stl'
        };

        // Fallback models in case of CORS issues
        const fallbackModels = {
            // You can add simple geometry as fallback
        };

        function open3DViewer(modelType) {
            console.log(`Opening 3D viewer for: ${modelType}`);
            const modal = document.getElementById('viewer-modal');
            const loadingText = document.getElementById('loading-text');
            const loadingDetails = document.getElementById('loading-details');
            
            modal.classList.add('active');
            loadingText.style.display = 'block';
            loadingDetails.textContent = `Loading ${modelType} model...`;
            
            // Initialize Three.js scene
            initViewer(modelType);
        }

        function close3DViewer() {
            const modal = document.getElementById('viewer-modal');
            modal.classList.remove('active');
            
            // Clean up
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            if (renderer) {
                renderer.dispose();
                renderer = null;
            }
            if (scene && currentModel) {
                scene.remove(currentModel);
                currentModel = null;
            }
            
            // Reset controls
            controls.isDragging = false;
            controls.previousMousePosition = { x: 0, y: 0 };
        }

        function initViewer(modelType) {
            const canvas = document.getElementById('viewer-canvas');
            const container = canvas.parentElement;
            const loadingText = document.getElementById('loading-text');
            const loadingDetails = document.getElementById('loading-details');
            
            // Clear previous scene if it exists
            if (scene) {
                while(scene.children.length > 0) { 
                    scene.remove(scene.children[0]); 
                }
            }
            
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a1a);
            
            // Add some reference helpers
            const gridHelper = new THREE.GridHelper(100, 20);
            scene.add(gridHelper);
            
            const axesHelper = new THREE.AxesHelper(50);
            scene.add(axesHelper);
            
            // Camera
            camera = new THREE.PerspectiveCamera(
                75,
                container.clientWidth / container.clientHeight,
                0.1,
                1000
            );
            camera.position.set(0, 0, 50);
            
            // Renderer
            if (renderer) {
                renderer.dispose();
            }
            renderer = new THREE.WebGLRenderer({ 
                canvas: canvas, 
                antialias: true,
                alpha: true 
            });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            // Lights - improved lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight1.position.set(10, 10, 10);
            scene.add(directionalLight1);
            
            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
            directionalLight2.position.set(-10, -10, -10);
            scene.add(directionalLight2);
            
            const directionalLight3 = new THREE.DirectionalLight(0xffffff, 0.3);
            directionalLight3.position.set(0, 10, 0);
            scene.add(directionalLight3);
            
            // Load STL model
            loadingDetails.textContent = 'Initializing STL loader...';
            
            // Check if STLLoader is available
            if (typeof THREE.STLLoader === 'undefined') {
                console.error('STLLoader not found!');
                loadingDetails.innerHTML = `
                    <div style="color: #e74c3c;">
                        <i class="fas fa-exclamation-triangle"></i> STLLoader not available
                    </div>
                `;
                createFallbackModel(modelType);
                return;
            }
            
            const loader = new THREE.STLLoader();
            const modelUrl = modelUrls[modelType];
            
            loadingDetails.textContent = `Downloading model from: ${modelUrl}`;
            
            // Add timeout
            const loadTimeout = setTimeout(() => {
                loadingDetails.innerHTML = `
                    Taking longer than expected...<br>
                    <small>Check console for errors</small>
                `;
            }, 5000);
            
            loader.load(
                modelUrl,
                // onLoad callback
                function(geometry) {
                    clearTimeout(loadTimeout);
                    console.log('Model loaded successfully:', geometry);
                    loadingText.style.display = 'none';
                    
                    // Center and normalize geometry
                    geometry.computeBoundingBox();
                    const center = new THREE.Vector3();
                    geometry.boundingBox.getCenter(center);
                    geometry.translate(-center.x, -center.y, -center.z);
                    
                    // Compute normals for proper lighting
                    geometry.computeVertexNormals();
                    
                    // Create material
                    const material = new THREE.MeshPhongMaterial({ 
                        color: getModelColor(modelType),
                        specular: 0x111111,
                        shininess: 200,
                        flatShading: false
                    });
                    
                    currentModel = new THREE.Mesh(geometry, material);
                    scene.add(currentModel);
                    
                    // Adjust camera to fit model
                    const bbox = new THREE.Box3().setFromObject(currentModel);
                    const size = bbox.getSize(new THREE.Vector3());
                    const maxDim = Math.max(size.x, size.y, size.z);
                    const fov = camera.fov * (Math.PI / 180);
                    let cameraZ = Math.abs(maxDim / Math.sin(fov / 2));
                    
                    cameraZ *= 1.1; // Add some padding
                    camera.position.z = cameraZ;
                    
                    const minZ = size.z * 0.5;
                    camera.near = minZ / 10;
                    camera.far = Math.max(1000, maxDim * 10);
                    camera.updateProjectionMatrix();
                    
                    console.log(`Model dimensions:`, size);
                    console.log(`Camera position: z=${camera.position.z}`);
                },
                // onProgress callback
                function(xhr) {
                    if (xhr.lengthComputable) {
                        const percent = (xhr.loaded / xhr.total * 100).toFixed(1);
                        loadingDetails.textContent = `Loading: ${percent}%`;
                    }
                },
                // onError callback
                function(error) {
                    clearTimeout(loadTimeout);
                    console.error('Error loading model:', error);
                    loadingDetails.innerHTML = `
                        <div style="color: #e74c3c;">
                            <i class="fas fa-exclamation-triangle"></i> Error loading model
                        </div>
                        <div style="font-size: 0.8rem; margin-top: 0.5rem;">
                            ${error.message || 'Check browser console and CORS settings'}
                        </div>
                    `;
                    
                    // Create a fallback cube
                    createFallbackModel(modelType);
                }
            );
            
            // Mouse controls
            setupMouseControls(canvas);
            
            // Animation loop
            function animate() {
                animationId = requestAnimationFrame(animate);
                
                // Auto-rotate when not dragging
                if (!controls.isDragging && currentModel) {
                    currentModel.rotation.y += 0.005;
                }
                
                renderer.render(scene, camera);
            }
            animate();
            
            // Handle window resize
            function handleResize() {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }
            
            window.addEventListener('resize', handleResize);
        }

        function setupMouseControls(canvas) {
            canvas.addEventListener('mousedown', (e) => {
                controls.isDragging = true;
                controls.previousMousePosition = { x: e.clientX, y: e.clientY };
            });
            
            canvas.addEventListener('mousemove', (e) => {
                if (controls.isDragging && currentModel) {
                    const deltaX = e.clientX - controls.previousMousePosition.x;
                    const deltaY = e.clientY - controls.previousMousePosition.y;
                    
                    currentModel.rotation.y += deltaX * 0.01;
                    currentModel.rotation.x += deltaY * 0.01;
                    
                    controls.previousMousePosition = { x: e.clientX, y: e.clientY };
                }
            });
            
            canvas.addEventListener('mouseup', () => {
                controls.isDragging = false;
            });
            
            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                const zoomSpeed = 0.001;
                camera.position.z += e.deltaY * camera.position.z * zoomSpeed;
                camera.position.z = Math.max(1, Math.min(1000, camera.position.z));
            });
        }

        function getModelColor(modelType) {
            const colors = {
                'dragster': 0x3498db, // Blue
                'robotdog': 0xe74c3c, // Red
                'printer': 0x2ecc71  // Green
            };
            return colors[modelType] || 0x95a5a6; // Default gray
        }

        function createFallbackModel(modelType) {
            const loadingText = document.getElementById('loading-text');
            loadingText.style.display = 'none';
            
            // Create a simple geometry as fallback
            const geometry = new THREE.BoxGeometry(10, 10, 10);
            const material = new THREE.MeshPhongMaterial({ 
                color: getModelColor(modelType),
                wireframe: true
            });
            
            currentModel = new THREE.Mesh(geometry, material);
            scene.add(currentModel);
            
            console.log('Created fallback model for:', modelType);
        }
    </script>
</body>
</html>
